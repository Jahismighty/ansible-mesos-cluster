---
# This playbook deploys the entire Mesos cluster infrastructure.
# RUN: ansible-playbook --ask-sudo-pass -i hosts site.yml
# RUN only mesos-master: ansible-playbook --ask-sudo-pass -i hosts site.yml --tags "mesos-master"
# RUN only mesos-slave: ansible-playbook --ask-sudo-pass -i hosts site.yml --tags "mesos-master"
# RUN only marathon: ansible-playbook --ask-sudo-pass -i hosts site.yml --tags "marathon"

- name: run common tasks for all mesos cluster nodes
  hosts: all
  sudo: True

  roles:
    - { role: common, tags: ["common"] }

# hosts in both the mesos_master and marathon groups
- name: deploy and configure mesos and slave hosts
  hosts: mesos_masters:&mesos_slaves
  sudo: True

  roles:
    - { role: mesos, mesos_install_mode: "master-slave", tags: ["mesos-master", "mesos-slave"] }

- name: deploy and configure the mesos master-only hosts
  hosts: mesos_masters:!mesos_slaves
  sudo: True

  roles:
    - { role: mesos, mesos_install_mode: "master", tags: ["mesos-master"] }

- name: deploy and configure the mesos slave-only hosts
  hosts: mesos_slaves:!mesos_masters
  sudo: True

  roles:
    - { role: mesos, mesos_install_mode: "slave", tags: ["mesos-slave"] }

  # hosts in both the mesos_master and marathon groups
- name: deploy and configure mesos and marathon hosts
  hosts: marathon:&mesos_masters
  sudo: True

  roles:
    - { role: marathon, marathon_only: False, tags: ["marathon"] }

  # hosts in only the marathon group
- name: deploy and configure marathon-only hosts
  hosts: marathon:!mesos_masters
  sudo: True

  roles:
    - { role: marathon, marathon_only: True, tags: ["marathon"] }
